{{- define "main" }}

{{ if and .Title .Content }}
<div class="p-4 flex-1 items-center justify-center">
  {{ partial "card-category-color.html" . }}
</div>
{{ end }}

{{/*  Set up the content loop  */}}
{{- $pages := slice }}
{{- $pages = .Site.Pages }} 
{{- $features := where $pages "Params.homeFeature" "eq" true }}

{{ if .Param "everything" }}
  <div class="lg:grid-cols-2 xl:grid-cols-4 p-4 mx-auto grid grid-cols-1 gap-12 xl:gap-6 mb-5">
    <h2 class="text-3xl uppercase lg:col-span-2 xl:col-span-4">{{ .Title }}</h2>
  {{ range $pages }}
    {{- partial "card-category-color.html" . }}
  {{- end }}
  </div>
{{ else }}

{{ if $features }}
  <div class="max-w-screen-lg p-4 mx-auto grid grid-cols-1 gap-12 mb-5">
    {{ if (.Param "contentTopBox") }}
      <div class="h-full first:sm:col-span-2 items-center rounded-2xl bg-sky-50 transition-[filter] hover:brightness-90 dark:text-gray-200 text-gray-800 dark:bg-sky-800 dark:hover:brightness-110">
        <div class="hpContent prose max-w-max p-5 text-lg ">
          {{ .Content }}
        </div>
      </div>
    {{ end }}
    {{- range first 1 $features }}
      {{- partial "card-category-color.html" . }} 
    {{- end }}
  </div>
{{ end }}

  <div class="lg:grid-cols-2  p-4 mx-auto grid grid-cols-1 gap-12  mb-5">
    <h2 class="lg:col-span-2 flex p-3 items-center mb-2 text-3xl uppercase">Latest stuff</h2>
      
    {{ $excludedSections := site.Params.excludedSections | default slice }}
    {{ $excludedCategories := site.Params.excludedCategories | default slice }}
    {{ $excludedTags := site.Params.excludedTags | default slice }}
    {{- $filteredPages := slice -}}
    {{- range $pages.ByLastmod.Reverse }}
      {{- $excludePage := false -}}
      {{- range .Params.categories }}
        {{- if in $excludedCategories . }}
          {{- $excludePage = true -}}
          {{- break -}}
        {{- end }}
      {{- end }}
      {{- range .Params.tags }}
        {{- if in $excludedTags . }}
          {{- $excludePage = true -}}
          {{- break -}}
        {{- end }}
      {{- end }}
      {{- if $excludePage }}
        {{- continue -}}
      {{- end }}
      
      {{- if in $excludedSections .Section }}
        {{- continue }}
      {{- end }}
      {{- if eq .Summary "" }}
        {{- continue }}
      {{- end }}
      {{- $filteredPages = $filteredPages | append . -}}
    {{- end }}

    {{ range (.Paginate $filteredPages 18).Pages }}
    {{/*  {{- range $filteredPages.Limit 18 }}  */}}
      {{- partial "card-category-color.html" . }}
    {{- end }}
    {{ template "_internal/pagination.html" . }}
  </div>
    
{{ end }}
{{- end }}
